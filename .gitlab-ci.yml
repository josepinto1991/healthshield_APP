# stages:
#   - sync

# variables:
#   GITHUB_USER: "josepinto1991"
#   GITHUB_REPO: "healthshield_APP"

# sync-to-github:
#   stage: sync
#   image: alpine:latest
#   before_script:
#     - apk add --no-cache git
#     - git config --global user.email "gitlab-ci@example.com"
#     - git config --global user.name "GitLab CI"
#   script:
#     # DEBUG: Mostrar información útil
#     - echo "=== INICIO SINCRONIZACIÓN ==="
#     - echo "Rama actual: $CI_COMMIT_REF_NAME"
#     - echo "Usuario GitHub: $GITHUB_USER"
    
#     # Configurar GitHub como remoto (usando token)
#     - git remote remove github 2>/dev/null || true
#     - git remote add github "https://$GITHUB_USER:$GITHUB_TOKEN@github.com/$GITHUB_USER/$GITHUB_REPO.git"
    
#     # Sincronizar la rama actual
#     - echo "Sincronizando rama: $CI_COMMIT_REF_NAME"
#     - git push github "$CI_COMMIT_REF_NAME" --force
    
#     # Sincronizar tags si existen
#     - git push github --tags --force 2>/dev/null || echo "No hay tags para sincronizar"
    
#     echo "✅ Sincronización completada con éxito"
#   rules:
#     - if: '$CI_PIPELINE_SOURCE == "push"'
#   only:
#     - main
#     - master
#     - develop

stages:
  - sync

variables:
  GITHUB_USER: "josepinto1991"
  GITHUB_REPO: "healthshield_APP"

sync-to-github:
  stage: sync
  image: alpine:latest
  before_script:
    - apk add --no-cache git
    - git config --global user.email "ci@gitlab.com"
    - git config --global user.name "GitLab CI"
  script:
    - echo "=== SINCRONIZACIÓN INICIADA ==="
    - git remote add github "https://$GITHUB_USER:$GITHUB_TOKEN@github.com/$GITHUB_USER/$GITHUB_REPO.git" || true
    - git push github $CI_COMMIT_REF_NAME --force
    - echo "✅ Sincronización completada"
  only:
    - main