stages:
  - sync

variables:
  GITHUB_USER: "josepinto1991"
  GITHUB_REPO: "healthshield_APP"

sync-to-github:
  stage: sync
  image: alpine:latest
  before_script:
    - apk add --no-cache git
    - git config --global user.email "ci@gitlab.com"
    - git config --global user.name "GitLab CI"
  script:
    - echo "=== SINCRONIZACIÓN INICIADA ==="
    
    # 1. Obtener TODAS las ramas y tags del origen
    - git fetch origin '+refs/heads/*:refs/heads/*' '+refs/tags/*:refs/tags/*'
    - echo "Ramas disponibles después de fetch:"
    - git branch -a
    
    # 2. Cambiar a la rama main explícitamente
    - git checkout main
    - echo "En rama: $(git branch --show-current)"
    
    # 3. Configurar GitHub como remoto
    - git remote add github "https://$GITHUB_USER:$GITHUB_TOKEN@github.com/$GITHUB_USER/$GITHUB_REPO.git" || true
    
    # 4. Empujar la rama main
    - echo "Empujando main a GitHub..."
    - git push github main --force
    
    # 5. Empujar todas las ramas (opcional)
    - echo "Empujando todas las ramas..."
    - git push github --all --force
    
    # 6. Empujar tags
    - echo "Empujando tags..."
    - git push github --tags --force 2>/dev/null || echo "No hay tags"
    
    - echo "✅ SINCRONIZACIÓN COMPLETADA CON ÉXITO"
  only:
    - main
  retry: 2